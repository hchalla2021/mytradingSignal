#!/bin/bash\n\n# ğŸ”¥ DEPLOY PRODUCTION WEBSOCKET SYSTEM\n\necho \"ğŸ”¥ DEPLOYING PRODUCTION WEBSOCKET SYSTEM\"\necho \"===========================================\"\n\n# Check if we're in the right directory\nif [ ! -f \"package.json\" ] && [ ! -f \"requirements.txt\" ]; then\n    echo \"âŒ Run this from the project root directory\"\n    exit 1\nfi\n\necho \"ğŸ“¦ Building frontend with mobile Safari fixes...\"\ncd frontend\nnpm run build\nif [ $? -ne 0 ]; then\n    echo \"âŒ Frontend build failed\"\n    exit 1\nfi\ncd ..\n\necho \"ğŸ”§ Installing backend dependencies...\"\ncd backend\npip install -r requirements.txt\ncd ..\n\necho \"âš™ï¸ Creating production environment config...\"\ncat << EOF > backend/.env.production\n# Production WebSocket Settings\nUSE_PRODUCTION_WEBSOCKET=true\nWEBSOCKET_PING_INTERVAL=25000\nWEBSOCKET_RECONNECT_DELAY=3000\nTICK_TIMEOUT_SECONDS=30\n\n# Keep your existing auth settings:\n# ZERODHA_API_KEY=your_key_here\n# ZERODHA_API_SECRET=your_secret_here\n# JWT_SECRET=your_jwt_secret\n# REDIS_URL=your_redis_url\nEOF\n\necho \"ğŸ§ª Testing production WebSocket...\"\necho \"âš ï¸  Make sure your Zerodha credentials are set in backend/.env\"\necho \"\"\necho \"To test:\"\necho \"  cd backend && python test_production_websocket.py\"\necho \"\"\necho \"To start production servers:\"\necho \"  Backend: cd backend && uvicorn main:app --host 0.0.0.0 --port 8000\"\necho \"  Frontend: cd frontend && npm start\"\necho \"\"\necho \"ğŸ“± Mobile Safari Test:\"\necho \"  1. Deploy to production domain\"\necho \"  2. Test on iPhone Safari\"\necho \"  3. Check browser console (should be error-free)\"\necho \"\"\necho \"âœ… PRODUCTION WEBSOCKET SYSTEM READY!\"\necho \"ğŸ¯ Features enabled:\"\necho \"   âœ… Silent connection detection\"\necho \"   âœ… Auto-recovery at 9:15 AM\"\necho \"   âœ… Market timing awareness\" \necho \"   âœ… Mobile Safari compatibility\"\necho \"   âœ… Real-time status monitoring\"\necho \"\"\necho \"ğŸ“Š Monitor status at: /api/health\"\necho \"ğŸ”„ Force reconnect: POST to /api/market/reconnect\"